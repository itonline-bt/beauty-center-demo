(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[987],{7307:function(e,t,s){Promise.resolve().then(s.bind(s,8818))},4314:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},94:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8818:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(3827),l=s(4090),n=s(7907),r=s(3036),i=s(9003),o=s(1965),c=s(5030),d=s(2169),m=s(3345),x=s(4697),u=s(1524),h=s(7461);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,h.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var p=s(94);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,h.Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),j=(0,h.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);var f=s(4314);function b(){let e=(0,n.useRouter)(),{user:t,isAuthenticated:s}=(0,r.t)(),{inventory:h,stockMovements:b,adjustStock:N}=(0,r.a)(),{locale:v}=(0,i.useI18n)(),[w,k]=(0,l.useState)(""),[q,_]=(0,l.useState)(!1),[S,Z]=(0,l.useState)("out"),[C,M]=(0,l.useState)(null),[I,A]=(0,l.useState)({quantity:"",reason:""});if((0,l.useEffect)(()=>{s||e.push("/login")},[s,e]),!s)return null;let T=h.filter(e=>e.quantity<=e.min_quantity),R=h.filter(e=>e.name.toLowerCase().includes(w.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(w.toLowerCase())),E=(0,l.useMemo)(()=>({totalItems:h.length,lowStock:T.length,movementsToday:b.filter(e=>e.date===new Date().toISOString().split("T")[0]).length,totalValue:h.reduce((e,t)=>e+t.quantity*t.cost_price,0)}),[h,b,T]),L=(e,t)=>{M(e),Z(t),A({quantity:"",reason:"out"===t?"lo"===v?"ໃຊ້ໃນການບໍລິການ":"Used for service":"lo"===v?"ຮັບສິນຄ້າເຂົ້າ":"Stock received"}),_(!0)},z="out"===S?["lo"===v?"ໃຊ້ໃນການບໍລິການ":"Used for service","lo"===v?"ເສຍຫາຍ":"Damaged","lo"===v?"ໝົດອາຍຸ":"Expired","lo"===v?"ຂາຍ":"Sold","lo"===v?"ໃຊ້ພາຍໃນ":"Internal use"]:["lo"===v?"ຮັບສິນຄ້າເຂົ້າ":"Stock received","lo"===v?"ໂອນຈາກສາຂາອື່ນ":"Transfer from branch","lo"===v?"ແກ້ໄຂສະຕັອກ":"Stock correction","lo"===v?"ຄືນສິນຄ້າ":"Return"],D=e=>e.image_url&&e.image_url.startsWith("data:")||e.image_url?e.image_url:(0,d.G)(e.name,e.category);return(0,a.jsx)(o.Z,{children:(0,a.jsxs)("div",{className:"space-y-6 animate-fadeIn",children:[(0,a.jsx)(c.mr,{title:"lo"===v?"ຈັດການສະຕັອກ":"Stock Management",subtitle:"lo"===v?"ເພີ່ມ ແລະ ຕັດສະຕັອກສິນຄ້າ":"Add and deduct inventory stock"}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-amber-600 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-amber-900",children:"lo"===v?"ການແຈ້ງເຕືອນອັດຕະໂນມັດ":"Automatic Notifications"}),(0,a.jsx)("p",{className:"text-sm text-amber-700",children:"lo"===v?"ທຸກຄັ້ງທີ່ມີການເບີກສິນຄ້າ ລະບົບຈະແຈ້ງເຕືອນໄປຫາ Admin ອັດຕະໂນມັດ":"Every stock deduction will automatically notify Admin"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(c.Rm,{title:"lo"===v?"ສິນຄ້າທັງໝົດ":"Total Items",value:(0,d.uf)(E.totalItems),icon:(0,a.jsx)(x.Z,{className:"w-6 h-6"}),color:"blue"}),(0,a.jsx)(c.Rm,{title:"lo"===v?"ສິນຄ້າໃກ້ໝົດ":"Low Stock",value:(0,d.uf)(E.lowStock),icon:(0,a.jsx)(u.Z,{className:"w-6 h-6"}),color:E.lowStock>0?"amber":"emerald"}),(0,a.jsx)(c.Rm,{title:"lo"===v?"ເຄື່ອນໄຫວມື້ນີ້":"Today Movements",value:(0,d.uf)(E.movementsToday),icon:(0,a.jsx)(y,{className:"w-6 h-6"}),color:"purple"}),(0,a.jsx)(c.Rm,{title:"lo"===v?"ມູນຄ່າລວມ":"Total Value",value:(0,d.xG)(E.totalValue),icon:(0,a.jsx)(x.Z,{className:"w-6 h-6"}),color:"emerald"})]}),T.length>0&&(0,a.jsx)(c.bZ,{variant:"warning",title:"lo"===v?"ສິນຄ້າໃກ້ໝົດ: ".concat(T.length," ລາຍການ"):"Low stock: ".concat(T.length," items"),children:(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:T.map(e=>(0,a.jsxs)("span",{className:"px-3 py-1 bg-amber-200/50 text-amber-800 rounded-full text-sm font-medium",children:["lo"===v?e.name_lo:e.name," (",(0,d.uf)(e.quantity),")"]},e.id))})}),(0,a.jsx)(c.Mj,{value:w,onChange:k,placeholder:"lo"===v?"ຄົ້ນຫາສິນຄ້າ...":"Search items..."}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:R.map(e=>(0,a.jsxs)(c.Zb,{hover:!0,className:"p-0 overflow-hidden ".concat(e.quantity<=e.min_quantity?"ring-2 ring-amber-300":""),children:[(0,a.jsxs)("div",{className:"relative h-32 bg-gray-100",children:[(0,a.jsx)("img",{src:D(e),alt:e.name,className:"w-full h-full object-cover",onError:t=>{t.target.src=(0,d.G)(e.name,e.category)}}),e.quantity<=e.min_quantity&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)(u.Z,{className:"w-6 h-6 text-amber-500 drop-shadow-lg"})})]}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:"lo"===v?e.name_lo:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500 font-mono mb-3",children:e.sku}),(0,a.jsx)("div",{className:"flex items-center justify-center py-3 bg-gray-50 rounded-xl mb-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-3xl font-bold ".concat(e.quantity<=e.min_quantity?"text-amber-600":0===e.quantity?"text-red-600":"text-gray-900"),children:(0,d.uf)(e.quantity)}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["lo"===v?"ຄົງເຫຼືອ":"In Stock"," (Min: ",(0,d.uf)(e.min_quantity),")"]})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.zx,{variant:"success",size:"sm",className:"flex-1",onClick:()=>L(e,"in"),icon:(0,a.jsx)(p.Z,{className:"w-4 h-4"}),children:"lo"===v?"ເພີ່ມ":"Add"}),(0,a.jsx)(c.zx,{variant:"danger",size:"sm",className:"flex-1",onClick:()=>L(e,"out"),icon:(0,a.jsx)(g,{className:"w-4 h-4"}),disabled:e.quantity<=0,children:"lo"===v?"ເບີກ":"Use"})]})]})]},e.id))}),(0,a.jsxs)(c.Zb,{padding:"none",children:[(0,a.jsxs)("div",{className:"px-5 py-4 border-b flex items-center gap-2",children:[(0,a.jsx)(y,{className:"w-5 h-5 text-gray-500"}),(0,a.jsx)("h2",{className:"font-semibold text-gray-900",children:"lo"===v?"ປະຫວັດການເຄື່ອນໄຫວລ່າສຸດ":"Recent Stock Movements"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50 border-b",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ວັນທີ/ເວລາ":"Date/Time"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ສິນຄ້າ":"Item"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ປະເພດ":"Type"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-600",children:"lo"===v?"ຈຳນວນ":"Qty"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ຄົງເຫຼືອ":"Stock"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ເຫດຜົນ":"Reason"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ຜູ້ເບີກ":"By"})]})}),(0,a.jsx)("tbody",{className:"divide-y",children:b.slice(0,15).map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 ".concat("out"===e.type?"bg-red-50/30":""),children:[(0,a.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-500",children:[(0,a.jsx)("div",{children:e.date}),e.time&&(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.time})]}),(0,a.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900",children:"lo"===v?e.inventory_name_lo:e.inventory_name}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)(c.Ct,{variant:"in"===e.type?"success":"danger",children:["in"===e.type?(0,a.jsx)(j,{className:"w-3 h-3 mr-1"}):(0,a.jsx)(f.Z,{className:"w-3 h-3 mr-1"}),"in"===e.type?"lo"===v?"ເຂົ້າ":"In":"lo"===v?"ອອກ":"Out"]})}),(0,a.jsxs)("td",{className:"px-4 py-3 text-center font-bold ".concat("in"===e.type?"text-emerald-600":"text-red-600"),children:["in"===e.type?"+":"-",(0,d.uf)(e.quantity)]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-500",children:[(0,d.uf)(e.previous_qty)," → ",(0,a.jsx)("span",{className:"font-medium text-gray-900",children:(0,d.uf)(e.new_qty)})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:"lo"===v&&e.reason_lo?e.reason_lo:e.reason}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.created_by_name})]},e.id))})]})})]}),(0,a.jsx)(c.u_,{isOpen:q,onClose:()=>_(!1),title:"in"===S?"lo"===v?"ເພີ່ມສະຕັອກ":"Add Stock":"lo"===v?"ເບີກສະຕັອກ":"Deduct Stock",children:C&&(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C&&I.quantity&&(N(C.id,Number(I.quantity),S,I.reason,(null==t?void 0:t.full_name)||"Admin"),_(!1),M(null),A({quantity:"",reason:""}))},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 p-4 rounded-xl ".concat("in"===S?"bg-emerald-50":"bg-red-50"),children:[(0,a.jsx)("img",{src:D(C),alt:C.name,className:"w-16 h-16 rounded-lg object-cover",onError:e=>{e.target.src=(0,d.G)(C.name,C.category)}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:"lo"===v?C.name_lo:C.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["lo"===v?"ຄົງເຫຼືອປັດຈຸບັນ:":"Current stock:"," ",(0,a.jsx)("span",{className:"font-bold text-lg",children:(0,d.uf)(C.quantity)})]})]})]}),"out"===S&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 text-amber-600"}),(0,a.jsx)("p",{className:"text-sm text-amber-800",children:"lo"===v?"การเบิกนี้จะแจ้งเตือนไปหา Admin โดย ".concat((null==t?void 0:t.full_name)||"User"):"This deduction will notify Admin by ".concat((null==t?void 0:t.full_name)||"User")})]}),(0,a.jsx)(c.II,{label:"lo"===v?"ຈຳນວນ":"Quantity",type:"number",value:I.quantity,onChange:e=>A({...I,quantity:e.target.value}),min:1,max:"out"===S?C.quantity:9999,required:!0}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"lo"===v?"ເຫດຜົນ":"Reason"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:z.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>A({...I,reason:e}),className:"px-3 py-1.5 text-sm rounded-full transition-colors ".concat(I.reason===e?"in"===S?"bg-emerald-500 text-white":"bg-red-500 text-white":"bg-gray-100 hover:bg-gray-200"),children:e},e))}),(0,a.jsx)("input",{type:"text",value:I.reason,onChange:e=>A({...I,reason:e.target.value}),className:"w-full px-4 py-2.5 border rounded-lg",placeholder:"lo"===v?"ຫຼື ພິມເຫດຜົນອື່ນ...":"Or type other reason...",required:!0})]}),(0,a.jsx)("div",{className:"p-4 rounded-xl ".concat("in"===S?"bg-emerald-50":"bg-red-50"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"lo"===v?"ສະຕັອກໃໝ່:":"New stock:"}),(0,a.jsx)("span",{className:"text-2xl font-bold ".concat("in"===S?"text-emerald-600":"text-red-600"),children:(0,d.uf)("in"===S?C.quantity+(Number(I.quantity)||0):Math.max(0,C.quantity-(Number(I.quantity)||0)))})]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,a.jsx)(c.zx,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>_(!1),children:"lo"===v?"ຍົກເລີກ":"Cancel"}),(0,a.jsx)(c.zx,{type:"submit",variant:"in"===S?"success":"danger",className:"flex-1",children:"lo"===v?"ຢືນຢັນ":"Confirm"})]})]})})]})})}}},function(e){e.O(0,[549,576,36,619,971,69,744],function(){return e(e.s=7307)}),_N_E=e.O()}]);