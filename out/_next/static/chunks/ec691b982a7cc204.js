(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27823,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},35320,e=>{"use strict";var t=e.i(29130),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(e,s)=>{let l=(0,t.forwardRef)(({color:l="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:o="",children:d,...c},m)=>(0,t.createElement)("svg",{ref:m,...a,width:r,height:r,stroke:l,strokeWidth:i?24*Number(n)/Number(r):n,className:["lucide",`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,o].join(" "),...c},[...s.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(d)?d:[d]]));return l.displayName=`${e}`,l};e.s(["default",()=>s],35320)},6180,e=>{"use strict";let t=(0,e.i(35320).default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);e.s(["Users",()=>t],6180)},66826,53207,e=>{"use strict";var t=e.i(35320);let a=(0,t.default)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);e.s(["Sparkles",()=>a],66826);let s=(0,t.default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],53207)},95508,e=>{"use strict";let t=(0,e.i(35320).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],95508)},77863,e=>{"use strict";let t=(0,e.i(35320).default)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);e.s(["ArrowDown",()=>t],77863)},76846,e=>{"use strict";var t=e.i(46623),a=e.i(29130),s=e.i(87577),l=e.i(89896),r=e.i(93841),n=e.i(1266),i=e.i(6261),o=e.i(28205),d=e.i(26541),c=e.i(95508),m=e.i(35320);let x=(0,m.default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var u=e.i(32366);let h=(0,m.default)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);var y=e.i(77863);let p=(0,m.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var g=e.i(11591);function f(){let e=(0,s.useRouter)(),{user:m,isAuthenticated:f}=(0,l.useAuthStore)(),{inventory:j,stockMovements:b,adjustStock:N}=(0,l.useDataStore)(),{locale:v}=(0,r.useI18n)(),[k,w]=(0,a.useState)(""),[q,S]=(0,a.useState)(!1),[C,_]=(0,a.useState)("out"),[M,A]=(0,a.useState)(null),[T,$]=(0,a.useState)({quantity:"",reason:""});if((0,a.useEffect)(()=>{f||e.push("/login")},[f,e]),!f)return null;let I=j.filter(e=>e.quantity<=e.min_quantity),U=j.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(k.toLowerCase())),L=(0,a.useMemo)(()=>({totalItems:j.length,lowStock:I.length,movementsToday:b.filter(e=>e.date===new Date().toISOString().split("T")[0]).length,totalValue:j.reduce((e,t)=>e+t.quantity*t.cost_price,0)}),[j,b,I]),P=(e,t)=>{A(e),_(t),$({quantity:"",reason:"out"===t?"lo"===v?"ໃຊ້ໃນການບໍລິການ":"Used for service":"lo"===v?"ຮັບສິນຄ້າເຂົ້າ":"Stock received"}),S(!0)},B="out"===C?["lo"===v?"ໃຊ້ໃນການບໍລິການ":"Used for service","lo"===v?"ເສຍຫາຍ":"Damaged","lo"===v?"ໝົດອາຍຸ":"Expired","lo"===v?"ຂາຍ":"Sold","lo"===v?"ໃຊ້ພາຍໃນ":"Internal use"]:["lo"===v?"ຮັບສິນຄ້າເຂົ້າ":"Stock received","lo"===v?"ໂອນຈາກສາຂາອື່ນ":"Transfer from branch","lo"===v?"ແກ້ໄຂສະຕັອກ":"Stock correction","lo"===v?"ຄືນສິນຄ້າ":"Return"],D=e=>e.image_url&&e.image_url.startsWith("data:")||e.image_url?e.image_url:(0,o.getProductImageUrl)(e.name,e.category);return(0,t.jsx)(n.default,{children:(0,t.jsxs)("div",{className:"space-y-6 animate-fadeIn",children:[(0,t.jsx)(i.PageHeader,{title:"lo"===v?"ຈັດການສະຕັອກ":"Stock Management",subtitle:"lo"===v?"ເພີ່ມ ແລະ ຕັດສະຕັອກສິນຄ້າ":"Add and deduct inventory stock"}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(g.Bell,{className:"w-5 h-5 text-amber-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-amber-900",children:"lo"===v?"ການແຈ້ງເຕືອນອັດຕະໂນມັດ":"Automatic Notifications"}),(0,t.jsx)("p",{className:"text-sm text-amber-700",children:"lo"===v?"ທຸກຄັ້ງທີ່ມີການເບີກສິນຄ້າ ລະບົບຈະແຈ້ງເຕືອນໄປຫາ Admin ອັດຕະໂນມັດ":"Every stock deduction will automatically notify Admin"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)(i.StatCard,{title:"lo"===v?"ສິນຄ້າທັງໝົດ":"Total Items",value:(0,o.formatNumber)(L.totalItems),icon:(0,t.jsx)(d.Package,{className:"w-6 h-6"}),color:"blue"}),(0,t.jsx)(i.StatCard,{title:"lo"===v?"ສິນຄ້າໃກ້ໝົດ":"Low Stock",value:(0,o.formatNumber)(L.lowStock),icon:(0,t.jsx)(u.AlertTriangle,{className:"w-6 h-6"}),color:L.lowStock>0?"amber":"emerald"}),(0,t.jsx)(i.StatCard,{title:"lo"===v?"ເຄື່ອນໄຫວມື້ນີ້":"Today Movements",value:(0,o.formatNumber)(L.movementsToday),icon:(0,t.jsx)(p,{className:"w-6 h-6"}),color:"purple"}),(0,t.jsx)(i.StatCard,{title:"lo"===v?"ມູນຄ່າລວມ":"Total Value",value:(0,o.formatCurrency)(L.totalValue),icon:(0,t.jsx)(d.Package,{className:"w-6 h-6"}),color:"emerald"})]}),I.length>0&&(0,t.jsx)(i.Alert,{variant:"warning",title:"lo"===v?`ສິນຄ້າໃກ້ໝົດ: ${I.length} ລາຍການ`:`Low stock: ${I.length} items`,children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:I.map(e=>(0,t.jsxs)("span",{className:"px-3 py-1 bg-amber-200/50 text-amber-800 rounded-full text-sm font-medium",children:["lo"===v?e.name_lo:e.name," (",(0,o.formatNumber)(e.quantity),")"]},e.id))})}),(0,t.jsx)(i.SearchInput,{value:k,onChange:w,placeholder:"lo"===v?"ຄົ້ນຫາສິນຄ້າ...":"Search items..."}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:U.map(e=>(0,t.jsxs)(i.Card,{hover:!0,className:`p-0 overflow-hidden ${e.quantity<=e.min_quantity?"ring-2 ring-amber-300":""}`,children:[(0,t.jsxs)("div",{className:"relative h-32 bg-gray-100",children:[(0,t.jsx)("img",{src:D(e),alt:e.name,className:"w-full h-full object-cover",onError:t=>{t.target.src=(0,o.getProductImageUrl)(e.name,e.category)}}),e.quantity<=e.min_quantity&&(0,t.jsx)("div",{className:"absolute top-2 right-2",children:(0,t.jsx)(u.AlertTriangle,{className:"w-6 h-6 text-amber-500 drop-shadow-lg"})})]}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:"lo"===v?e.name_lo:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 font-mono mb-3",children:e.sku}),(0,t.jsx)("div",{className:"flex items-center justify-center py-3 bg-gray-50 rounded-xl mb-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:`text-3xl font-bold ${e.quantity<=e.min_quantity?"text-amber-600":0===e.quantity?"text-red-600":"text-gray-900"}`,children:(0,o.formatNumber)(e.quantity)}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["lo"===v?"ຄົງເຫຼືອ":"In Stock"," (Min: ",(0,o.formatNumber)(e.min_quantity),")"]})]})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.Button,{variant:"success",size:"sm",className:"flex-1",onClick:()=>P(e,"in"),icon:(0,t.jsx)(c.Plus,{className:"w-4 h-4"}),children:"lo"===v?"ເພີ່ມ":"Add"}),(0,t.jsx)(i.Button,{variant:"danger",size:"sm",className:"flex-1",onClick:()=>P(e,"out"),icon:(0,t.jsx)(x,{className:"w-4 h-4"}),disabled:e.quantity<=0,children:"lo"===v?"ເບີກ":"Use"})]})]})]},e.id))}),(0,t.jsxs)(i.Card,{padding:"none",children:[(0,t.jsxs)("div",{className:"px-5 py-4 border-b flex items-center gap-2",children:[(0,t.jsx)(p,{className:"w-5 h-5 text-gray-500"}),(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"lo"===v?"ປະຫວັດການເຄື່ອນໄຫວລ່າສຸດ":"Recent Stock Movements"})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ວັນທີ/ເວລາ":"Date/Time"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ສິນຄ້າ":"Item"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ປະເພດ":"Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-600",children:"lo"===v?"ຈຳນວນ":"Qty"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ຄົງເຫຼືອ":"Stock"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ເຫດຜົນ":"Reason"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-600",children:"lo"===v?"ຜູ້ເບີກ":"By"})]})}),(0,t.jsx)("tbody",{className:"divide-y",children:b.slice(0,15).map(e=>(0,t.jsxs)("tr",{className:`hover:bg-gray-50 ${"out"===e.type?"bg-red-50/30":""}`,children:[(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-500",children:[(0,t.jsx)("div",{children:e.date}),e.time&&(0,t.jsx)("div",{className:"text-xs text-gray-400",children:e.time})]}),(0,t.jsx)("td",{className:"px-4 py-3 font-medium text-gray-900",children:"lo"===v?e.inventory_name_lo:e.inventory_name}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)(i.Badge,{variant:"in"===e.type?"success":"danger",children:["in"===e.type?(0,t.jsx)(h,{className:"w-3 h-3 mr-1"}):(0,t.jsx)(y.ArrowDown,{className:"w-3 h-3 mr-1"}),"in"===e.type?"lo"===v?"ເຂົ້າ":"In":"lo"===v?"ອອກ":"Out"]})}),(0,t.jsxs)("td",{className:`px-4 py-3 text-center font-bold ${"in"===e.type?"text-emerald-600":"text-red-600"}`,children:["in"===e.type?"+":"-",(0,o.formatNumber)(e.quantity)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-500",children:[(0,o.formatNumber)(e.previous_qty)," → ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:(0,o.formatNumber)(e.new_qty)})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:"lo"===v&&e.reason_lo?e.reason_lo:e.reason}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.created_by_name})]},e.id))})]})})]}),(0,t.jsx)(i.Modal,{isOpen:q,onClose:()=>S(!1),title:"in"===C?"lo"===v?"ເພີ່ມສະຕັອກ":"Add Stock":"lo"===v?"ເບີກສະຕັອກ":"Deduct Stock",children:M&&(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),M&&T.quantity&&(N(M.id,Number(T.quantity),C,T.reason,m?.full_name||"Admin"),S(!1),A(null),$({quantity:"",reason:""}))},className:"space-y-4",children:[(0,t.jsxs)("div",{className:`flex items-center gap-4 p-4 rounded-xl ${"in"===C?"bg-emerald-50":"bg-red-50"}`,children:[(0,t.jsx)("img",{src:D(M),alt:M.name,className:"w-16 h-16 rounded-lg object-cover",onError:e=>{e.target.src=(0,o.getProductImageUrl)(M.name,M.category)}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:"lo"===v?M.name_lo:M.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["lo"===v?"ຄົງເຫຼືອປັດຈຸບັນ:":"Current stock:"," ",(0,t.jsx)("span",{className:"font-bold text-lg",children:(0,o.formatNumber)(M.quantity)})]})]})]}),"out"===C&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[(0,t.jsx)(g.Bell,{className:"w-5 h-5 text-amber-600"}),(0,t.jsx)("p",{className:"text-sm text-amber-800",children:"lo"===v?`การเบิกนี้จะแจ้งเตือนไปหา Admin โดย ${m?.full_name||"User"}`:`This deduction will notify Admin by ${m?.full_name||"User"}`})]}),(0,t.jsx)(i.Input,{label:"lo"===v?"ຈຳນວນ":"Quantity",type:"number",value:T.quantity,onChange:e=>$({...T,quantity:e.target.value}),min:1,max:"out"===C?M.quantity:9999,required:!0}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"lo"===v?"ເຫດຜົນ":"Reason"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:B.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>$({...T,reason:e}),className:`px-3 py-1.5 text-sm rounded-full transition-colors ${T.reason===e?"in"===C?"bg-emerald-500 text-white":"bg-red-500 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:e},e))}),(0,t.jsx)("input",{type:"text",value:T.reason,onChange:e=>$({...T,reason:e.target.value}),className:"w-full px-4 py-2.5 border rounded-lg",placeholder:"lo"===v?"ຫຼື ພິມເຫດຜົນອື່ນ...":"Or type other reason...",required:!0})]}),(0,t.jsx)("div",{className:`p-4 rounded-xl ${"in"===C?"bg-emerald-50":"bg-red-50"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"lo"===v?"ສະຕັອກໃໝ່:":"New stock:"}),(0,t.jsx)("span",{className:`text-2xl font-bold ${"in"===C?"text-emerald-600":"text-red-600"}`,children:(0,o.formatNumber)("in"===C?M.quantity+(Number(T.quantity)||0):Math.max(0,M.quantity-(Number(T.quantity)||0)))})]})}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(i.Button,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>S(!1),children:"lo"===v?"ຍົກເລີກ":"Cancel"}),(0,t.jsx)(i.Button,{type:"submit",variant:"in"===C?"success":"danger",className:"flex-1",children:"lo"===v?"ຢືນຢັນ":"Confirm"})]})]})})]})})}e.s(["default",()=>f],76846)}]);